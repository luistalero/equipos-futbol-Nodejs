tags:
  - name: Autenticación
    description: Endpoints para el registro, inicio de sesión y recuperación de contraseña.

paths:
  /auth/register:
    post:
      summary: Registra un nuevo usuario en el sistema.
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: Nombre de usuario único.
                  example: nuevo_usuario
                password:
                  type: string
                  description: Contraseña del usuario (se hasheará).
                  example: password123
                role:
                  type: string
                  enum: [admin, user]
                  default: user
                  description: Rol del usuario (admin o user).
                  example: user
      responses:
        201:
          description: Usuario registrado exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Usuario registrado exitosamente.
                  userId:
                    type: integer
                    example: 1
                  username:
                    type: string
                    example: nuevo_usuario
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        409:
          description: El nombre de usuario ya está en uso.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: El nombre de usuario ya está en uso.
        500:
          description: Error interno del servidor.

  /auth/login:
    post:
      summary: Inicia sesión y devuelve un token JWT.
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: Nombre de usuario registrado.
                  example: usuario_existente
                password:
                  type: string
                  description: Contraseña del usuario.
                  example: password123
      responses:
        200:
          description: Inicio de sesión exitoso.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Inicio de sesión exitoso.
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  userId:
                    type: integer
                    example: 1
                  username:
                    type: string
                    example: usuario_existente
                  role:
                    type: string
                    example: user
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          description: Error interno del servidor.

  /auth/forgot-password:
    post:
      summary: Envía un enlace de recuperación de contraseña al correo electrónico del usuario.
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: El correo electrónico del usuario.
                  example: usuario@ejemplo.com
      responses:
        200:
          description: Mensaje de éxito genérico para evitar dar pistas si el correo existe o no.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Si el correo electrónico existe, se ha enviado un enlace para restablecer la contraseña.
        500:
          description: Error interno del servidor.
  
  /auth/reset-password:
    post:
      summary: Restablece la contraseña del usuario utilizando un token de recuperación.
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                  description: El token de recuperación recibido por correo.
                  example: c9e0d1b4a3c5e7f2a1b9d0c3e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c2d1e0f9
                newPassword:
                  type: string
                  description: La nueva contraseña para el usuario.
                  example: NuevaPassword123
      responses:
        200:
          description: La contraseña se ha restablecido exitosamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Contraseña actualizada correctamente.
        400:
          description: Token de recuperación inválido o expirado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: El token es inválido o ha expirado.
        500:
          description: Error interno del servidor.

  /auth/profile:
    get:
      summary: Obtiene el perfil del usuario autenticado.
      tags: [Autenticación]
      security:
        - bearerAuth: []
      responses:
        200:
          description: Perfil del usuario autenticado.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Acceso autorizado al perfil.
                  userId:
                    type: integer
                    example: 1
                  userRole:
                    type: string
                    example: user
        401:
          $ref: '#/components/responses/UnauthorizedError'
        403:
          description: Prohibido (Token no proporcionado o formato incorrecto).
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token no proporcionado o formato incorrecto.